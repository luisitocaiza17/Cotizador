diff --git a/build/classes/com/qbe/cotizador/servlets/entidad/BeneficiarioController.class b/build/classes/com/qbe/cotizador/servlets/entidad/BeneficiarioController.class
index 54de06468b74df530b0edd38c86f68fb4de82d98..97b4c3d381d7841ddcce8e16ca0d85b549ad265f
GIT binary patch
literal 5536
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

diff --git a/src/com/qbe/cotizador/servlets/entidad/BeneficiarioController.java b/src/com/qbe/cotizador/servlets/entidad/BeneficiarioController.java
--- a/src/com/qbe/cotizador/servlets/entidad/BeneficiarioController.java
+++ b/src/com/qbe/cotizador/servlets/entidad/BeneficiarioController.java
@@ -136,6 +136,20 @@
 	                result.put("numRegistros", i);
 	                result.put("listadoBeneficiarios", beneficiarioJSONArray);
 			 }
+			 
+			 if (tipoConsulta.equals("cargarSelect3")) {
+	                List<Beneficiario> results = beneficiarioDAO.buscarActivos();
+	                int i = 0;
+	                for (i = 0; i < results.size(); i++) {
+	                    beneficiario = results.get(i);
+	                    beneficiarioJSONObject.put("id", beneficiario.getId());
+	                    beneficiarioJSONObject.put("text", beneficiario.getNombre()+" (Ensurance Id: "+beneficiario.getCodigoEnsurance()+")");
+	                   
+	                    beneficiarioJSONArray.add(beneficiarioJSONObject);
+	                }
+	                result.put("numRegistros", i);
+	                result.put("listadoBeneficiarios", beneficiarioJSONArray);
+			 }
 			
             result.put("success", Boolean.TRUE);
             response.setContentType("application/json; charset=ISO-8859-1");
diff --git a/src/com/qbe/cotizador/servlets/producto/agricola/AgriAgriPacController.java b/src/com/qbe/cotizador/servlets/producto/agricola/AgriAgriPacController.java
--- a/src/com/qbe/cotizador/servlets/producto/agricola/AgriAgriPacController.java
+++ b/src/com/qbe/cotizador/servlets/producto/agricola/AgriAgriPacController.java
@@ -649,16 +649,7 @@
 			        			valorSuperBancos = Math.rint(Double.parseDouble(variable.getValor())*valorFinalPrima/100*100)/100;
 			                    cotizacion.setImpSuperBancos(valorSuperBancos);
 			                    valorBase = valorBase + valorSuperBancos;
-			        		}
-			        		
-			        		if(variable.getNombre().equals("COMISION_AGRIPAC")){
-			        			 cotizacion.setPorcentajeComision(Double.parseDouble(variable.getValor()));//%COMISION DE AGENTE
-			        		}
-			        		 	
-			        		if(variable.getNombre().equals("AGENTE_AGRIPAC")){
-			        			cotizacion.setAgenteId(new BigInteger(variable.getValor()));//AGENTE AL QUE SE ATA id cotizador
-			        			
-			        		}
+			        		}	
 			        		else if(variable.getNombre().equals("SUBTOTAL")){
 			                    valorSubTotal = Math.rint(valorBase*100)/100;
 			                }
@@ -691,6 +682,8 @@
 						cotizacion.setTotalFactura(Double.parseDouble(""+roundOff));
 						
 			        }
+					cotizacion.setAgenteId(new BigInteger(PPuntoVenta.getAgenteId()));
+					cotizacion.setPorcentajeComision(Double.parseDouble(PPuntoVenta.getPorcentajeComision()));
 					cotizacion.setTasaProductoValor(tasa);
 					cotizacion.setEtapaWizard(3);
 					cotizacion.setClienteId(new BigInteger(cliente.getId()));
diff --git a/src/com/qbe/cotizador/servlets/producto/agricola/AgriEcuaquimicaController.java b/src/com/qbe/cotizador/servlets/producto/agricola/AgriEcuaquimicaController.java
--- a/src/com/qbe/cotizador/servlets/producto/agricola/AgriEcuaquimicaController.java
+++ b/src/com/qbe/cotizador/servlets/producto/agricola/AgriEcuaquimicaController.java
@@ -641,16 +641,7 @@
 			        			valorSuperBancos = Math.rint(Double.parseDouble(variable.getValor())*valorFinalPrima/100*100)/100;
 			                    cotizacion.setImpSuperBancos(valorSuperBancos);
 			                    valorBase = valorBase + valorSuperBancos;
-			        		}
-			        		
-			        		if(variable.getNombre().equals("COMISION_ECUAQUIMICA")){
-			        			 cotizacion.setPorcentajeComision(Double.parseDouble(variable.getValor()));//%COMISION DE AGENTE
-			        		}
-			        		 	
-			        		if(variable.getNombre().equals("AGENTE_ECUAQUIMICA")){
-			        			cotizacion.setAgenteId(new BigInteger(variable.getValor()));//AGENTE AL QUE SE ATA
-			        			
-			        		}
+			        		}			        		
 			        		else if(variable.getNombre().equals("SUBTOTAL")){
 			                    valorSubTotal = Math.rint(valorBase*100)/100;
 			                }
@@ -686,6 +677,8 @@
 					cotizacion.setTasaProductoValor(tasa);
 					cotizacion.setEtapaWizard(3);
 					cotizacion.setClienteId(new BigInteger(cliente.getId()));
+					cotizacion.setAgenteId(new BigInteger(PPuntoVenta.getAgenteId()));
+					cotizacion.setPorcentajeComision(Double.parseDouble(PPuntoVenta.getPorcentajeComision()));
 					
 					cotizacion.setEstado(estadoDAO.buscarPorNombre(	"Pendiente de Emitir", "Cotizacion"));
 					cotizacion.setFechaEmision(sq);
diff --git a/src/com/qbe/cotizador/servlets/producto/agricola/AgriReglaController.java b/src/com/qbe/cotizador/servlets/producto/agricola/AgriReglaController.java
--- a/src/com/qbe/cotizador/servlets/producto/agricola/AgriReglaController.java
+++ b/src/com/qbe/cotizador/servlets/producto/agricola/AgriReglaController.java
@@ -7,9 +7,10 @@
 import java.text.SimpleDateFormat;
 import java.util.Date;
 import java.util.List;
+
 import javax.servlet.ServletException;
 import javax.servlet.annotation.WebServlet;
 import javax.servlet.http.HttpServlet;
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 import javax.servlet.http.HttpSession;
@@ -10,8 +11,9 @@
 import javax.servlet.ServletException;
 import javax.servlet.annotation.WebServlet;
 import javax.servlet.http.HttpServlet;
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 import javax.servlet.http.HttpSession;
+
 import net.sf.json.JSONArray;
 import net.sf.json.JSONObject;
@@ -16,8 +18,10 @@
 import net.sf.json.JSONArray;
 import net.sf.json.JSONObject;
+
+import com.google.gson.Gson;
 import com.qbe.cotizador.dao.entidad.CantonDAO;
 import com.qbe.cotizador.dao.entidad.ProvinciaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaAuditoriaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaAuditoriaNuevaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaAuditoriaOriginalDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaDAO;
@@ -18,12 +22,13 @@
 import com.qbe.cotizador.dao.entidad.CantonDAO;
 import com.qbe.cotizador.dao.entidad.ProvinciaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaAuditoriaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaAuditoriaNuevaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaAuditoriaOriginalDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriReglaDAO;
+import com.qbe.cotizador.dao.producto.agricola.AgriReglaVtaDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriTipoCalculoDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriTipoCultivoDAO;
 import com.qbe.cotizador.model.AgriRegla;
 import com.qbe.cotizador.model.AgriReglaAuditoria;
 import com.qbe.cotizador.model.AgriReglaNueva;
 import com.qbe.cotizador.model.AgriReglaOriginal;
@@ -24,9 +29,10 @@
 import com.qbe.cotizador.dao.producto.agricola.AgriTipoCalculoDAO;
 import com.qbe.cotizador.dao.producto.agricola.AgriTipoCultivoDAO;
 import com.qbe.cotizador.model.AgriRegla;
 import com.qbe.cotizador.model.AgriReglaAuditoria;
 import com.qbe.cotizador.model.AgriReglaNueva;
 import com.qbe.cotizador.model.AgriReglaOriginal;
+import com.qbe.cotizador.model.AgriReglaVta;
 import com.qbe.cotizador.model.AgriTipoCalculo;
 import com.qbe.cotizador.model.AgriTipoCultivo;
 import com.qbe.cotizador.model.Canton;
@@ -57,6 +63,7 @@
 	 */
 	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
 		// TODO Auto-generated method stub
+		doPost(request, response);
 	}
 
 	/**
@@ -81,6 +88,7 @@
 			String AceptabilidadHasta = request.getParameter("AceptabilidadHasta")==null?"":request.getParameter("AceptabilidadHasta");
 			String Observaciones = request.getParameter("Observaciones")==null?"":request.getParameter("Observaciones");
 			String Copy = request.getParameter("Copy")==null?"":request.getParameter("Copy");
+			String Estado = request.getParameter("Estado")==null?"":request.getParameter("Estado");
 			
 			JSONObject ReglaJSONObjetc = new JSONObject();
 			JSONArray ReglaJSONArray = new JSONArray();
@@ -93,6 +101,8 @@
 			
 			// Activacion de la sesion y agregamosclie
 			DateFormat df = new SimpleDateFormat("yyyy-MM-dd");
+			if(!Estado.equals(""))
+				agriRegla.setEstado(Integer.parseInt(Estado));
 			if (!ReglaId.equals(""))
 				agriRegla.setReglaId(new BigInteger(ReglaId) );
 			if (!TipoCultivoId.equals(""))
@@ -122,8 +132,32 @@
 			if (!Observaciones.equals(""))
 				agriRegla.setObservaciones(Observaciones);
 			
-			//if (!Estado.equals(""))
-			//agriRegla.setEstado(new Integer(Estado));
+			if(tipoConsulta.equals("encontrarPorParametros")){
+				/*cargamos la tabla*/
+				int skip = request.getParameter("skip") == null ? 0 : Integer.parseInt(request.getParameter("skip"));
+				int take = request.getParameter("take") == null ? 20 : Integer.parseInt(request.getParameter("take"));
+				int EstadoId=1;
+				
+				if(Estado.equals("1"))
+					EstadoId=1;
+				else
+					EstadoId=0;
+				
+				AgriReglaVtaDAO agriReglaVtaDAO = new AgriReglaVtaDAO();
+				List<AgriReglaVta> data = agriReglaVtaDAO.BuscarPorParametrosKendo(ReglaId,TipoCultivoId,TipoCalculoId,ProvinciaId,CantonId,skip, take,EstadoId);
+				long total=agriReglaVtaDAO.BuscarPorParametrosKendoPorNumero(ReglaId,TipoCultivoId,TipoCalculoId,ProvinciaId,CantonId,skip, take,EstadoId);
+				DataSourceResult pg = new DataSourceResult();
+				pg.setTotal((int)total);
+				pg.setData(data);
+				
+				Gson gson = new Gson(); 
+				// convert the DataSourceReslt to JSON and write it to the response
+				response.setContentType("application/json; charset=ISO-8859-1");
+			    response.getWriter().print(gson.toJson(pg));
+			    return;	
+			}
+			
+			
 			if (tipoConsulta.equals("encontrarTodos"))
 			{
 				List<AgriRegla> results = agriReglaDAO.BuscarTodos();
@@ -155,4 +189,5 @@
 			}
 			if (tipoConsulta.equals("obtenerPorId"))
 			{
+				String EstadoId = request.getParameter("EstadoConsulta")==null?"":request.getParameter("EstadoConsulta");
 				SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd");
@@ -158,8 +193,8 @@
 				SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd");
-				AgriRegla results =agriReglaDAO.BuscarPorId(new BigInteger(ReglaId));
+				AgriRegla results =agriReglaDAO.BuscarPorId(new BigInteger(ReglaId),Integer.parseInt(EstadoId));
 				result.put("ReglaId", results.getReglaId());
 				result.put("TipoCultivoId", results.getTipoCultivoId());
 				result.put("CicloId", results.getClicloId());
 				result.put("TipoCalculoId", results.getTipoCalculoId());
 				result.put("ProvinciaId", results.getProvinciaId());
 				result.put("CantonId", results.getCantonId());
@@ -160,10 +195,10 @@
 				result.put("ReglaId", results.getReglaId());
 				result.put("TipoCultivoId", results.getTipoCultivoId());
 				result.put("CicloId", results.getClicloId());
 				result.put("TipoCalculoId", results.getTipoCalculoId());
 				result.put("ProvinciaId", results.getProvinciaId());
 				result.put("CantonId", results.getCantonId());
-				
+				result.put("activo", results.getEstado());
 				result.put("CostoProduccion", results.getCostoProduccion());
 				result.put("Tasa", results.getTasa());
 				result.put("CostoMantenimiento", results.getCostoMantenimiento());
@@ -179,9 +214,8 @@
 				result.put("Estado", results.getEstado());
 			}
 			if (tipoConsulta.equals("crear")){				
-				agriRegla.setEstado(1);
 				agriRegla = agriReglaTransaction.crear(agriRegla);
 				auditoria(agriRegla, tipoConsulta, session);
 			}
 			
 			if (tipoConsulta.equals("editar")){				
@@ -183,10 +217,8 @@
 				agriRegla = agriReglaTransaction.crear(agriRegla);
 				auditoria(agriRegla, tipoConsulta, session);
 			}
 			
 			if (tipoConsulta.equals("editar")){				
-				
-				agriRegla.setEstado(1);
 				auditoria(agriRegla, tipoConsulta, session);
 				agriReglaTransaction.editar(agriRegla);
 			}
@@ -195,48 +227,6 @@
 					auditoria(agriRegla, tipoConsulta, session);
 					agriReglaTransaction.eliminar(agriRegla);
 				}
-			
-			if (tipoConsulta.equals("copiar")){				
-				
-				String[] list = Copy.split(",");
-				for(String r : list){
-					if(!r.equals("")){
-						AgriRegla results =agriReglaDAO.BuscarPorId(new BigInteger(r));
-						if(results != null){
-							if (!TipoCultivoId.equals(""))
-								results.setTipoCultivoId(new BigInteger(TipoCultivoId));
-							if (!CicloId.equals(""))
-								results.setClicloId(new BigInteger(CicloId));
-							if (!TipoCalculoId.equals(""))
-								results.setTipoCalculoId(new BigInteger(TipoCalculoId));
-							if (!ProvinciaId.equals(""))
-								results.setProvinciaId(new BigInteger(ProvinciaId));
-							if (!CantonId.equals(""))
-								results.setCantonId(new BigInteger(CantonId));
-							if (!CostoProduccion.equals(""))
-								results.setCostoProduccion(new Float(CostoProduccion));
-							if (!Tasa.equals(""))
-								results.setTasa(new Float(Tasa));
-							if (!CostoMantenimiento.equals(""))
-								results.setCostoMantenimiento(new Float(CostoMantenimiento));
-							if (!AceptabilidadDesde.equals("")){
-								Date fechaD = df.parse(AceptabilidadDesde);
-								results.setAceptabilidadDesde(fechaD);
-							}
-							if (!AceptabilidadHasta.equals("")){
-								Date fechaH = df.parse(AceptabilidadHasta);
-								results.setAceptabilidadHasta(fechaH);
-							}
-							if (!Observaciones.equals(""))
-								results.setObservaciones(Observaciones);
-							
-							results.setEstado(1);
-							results = agriReglaTransaction.crear(results);
-							auditoria(results, tipoConsulta, session);							
-						}
-					}
-				}
-			}
 			result.put("success", Boolean.TRUE);
 			response.setContentType("application/json; charset=ISO-8859-1"); 
 			result.write(response.getWriter());
@@ -267,7 +257,7 @@
 		
 		/*Busco si existe el registro*/
 		AgriReglaDAO agriReglaDAO = new AgriReglaDAO();
-		AgriRegla results =agriReglaDAO.BuscarPorId(arg.getReglaId());		
+		AgriRegla results =agriReglaDAO.BuscarPorIdTodos(arg.getReglaId());		
 		/*Busco si existe el registro*/
 		agriAuditoriaRegla.setReglaId(results.getReglaId());
 		agriAuditoriaRegla.setFechaModificacion(fechaValidacion);
